<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI Telegram Bot Constructor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.3/nacl.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl-util/0.15.1/nacl-util.min.js"></script>

<style>
body{background:#0f1115;color:#fff;font-family:monospace;padding:20px}
input,textarea{
width:100%;
margin:6px 0;
padding:10px;
background:#1a1d24;
border:1px solid #333;
color:#fff
}
textarea{height:120px}
button{
padding:12px;
background:#00ff99;
border:none;
font-weight:bold;
cursor:pointer
}
#log{
background:#000;
padding:10px;
height:300px;
overflow:auto;
margin-top:15px
}
</style>
</head>
<body>

<h2>üî• AI Telegram Bot Constructor (Fixed)</h2>

<input id="token" placeholder="GitHub PAT (repo + workflow)">
<input id="repo" placeholder="Repository name">
<input id="tg" placeholder="Telegram Bot Token">
<input id="openrouter" placeholder="OpenRouter API Key">

<textarea id="desc" placeholder="–û–ø–∏—à–∏ –∫–∞–∫–æ–≥–æ –±–æ—Ç–∞ —Å–æ–∑–¥–∞—Ç—å..."></textarea>

<button onclick="install()">GENERATE & DEPLOY</button>

<pre id="log"></pre>

<script>
const logEl=document.getElementById("log");
function log(t){logEl.textContent+=t+"\\n";logEl.scrollTop=logEl.scrollHeight;}
function b64(s){return btoa(unescape(encodeURIComponent(s)));}

async function install(){

const token=document.getElementById("token").value.trim();
const repo=document.getElementById("repo").value.trim();
const tg=document.getElementById("tg").value.trim();
const openrouter=document.getElementById("openrouter").value.trim();
const desc=document.getElementById("desc").value.trim();

if(!token||!repo||!tg||!openrouter||!desc){
log("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è");
return;
}

const headers={
Authorization:`token ${token}`,
Accept:"application/vnd.github+json",
"Content-Type":"application/json"
};

try{

log("‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub");
const userRes=await fetch("https://api.github.com/user",{headers});
if(!userRes.ok) throw new Error("PAT –Ω–µ–≤–µ—Ä–Ω—ã–π");
const user=await userRes.json();
const username=user.login;
log("‚úì –ê–∫–∫–∞—É–Ω—Ç: "+username);

log("‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è");
await fetch("https://api.github.com/user/repos",{
method:"POST",
headers,
body:JSON.stringify({name:repo,private:false})
});

const repoApi=`https://api.github.com/repos/${username}/${repo}`;

log("‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ AI");

const aiRes=await fetch("https://openrouter.ai/api/v1/chat/completions",{
method:"POST",
headers:{
Authorization:`Bearer ${openrouter}`,
"Content-Type":"application/json"
},
body:JSON.stringify({
model:"openai/gpt-4o-mini",
messages:[
{role:"system",content:
"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π Telegram –±–æ—Ç –Ω–∞ Node.js (long polling) –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∫—Ä–æ–º–µ node-fetch. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥, inline –∫–Ω–æ–ø–æ–∫, callback_query, —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ JSON —Ö—Ä–∞–Ω–µ–Ω–∏—è."},
{role:"user",content:desc}
],
temperature:0.3
})
});

const aiData=await aiRes.json();
const botCode=aiData.choices?.[0]?.message?.content;

if(!botCode || botCode.length<500){
throw new Error("AI –≤–µ—Ä–Ω—É–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–¥–∞");
}

log("‚úì –ö–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω");

async function upload(path,content){
await fetch(`${repoApi}/contents/${path}`,{
method:"PUT",
headers,
body:JSON.stringify({
message:"auto upload "+path,
content:b64(content)
})
});
log("‚úì "+path);
}

await upload("bot.js",botCode);

await upload("package.json",JSON.stringify({
type:"module",
dependencies:{ "node-fetch":"^3.3.2" }
},null,2));

await upload("offset.json",'{"offset":0}');
await upload("users.json",'{}');

const workflow=`
name: AI Bot Runner
on:
schedule:
- cron: "*/5 * * * *"
workflow_dispatch:
jobs:
run:
runs-on: ubuntu-latest
timeout-minutes: 350
steps:
- uses: actions/checkout@v4
- uses: actions/setup-node@v4
with:
node-version: 20
- run: npm install
- run: node bot.js
env:
TELEGRAM_TOKEN: \${{ secrets.TELEGRAM_TOKEN }}
OPENROUTER_KEY: \${{ secrets.OPENROUTER_KEY }}
GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
`;

await upload(".github/workflows/runner.yml",workflow);

log("‚Üí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤");

const keyRes=await fetch(`${repoApi}/actions/secrets/public-key`,{headers});
const keyData=await keyRes.json();

const publicKey=keyData.key;
const key_id=keyData.key_id;

function encryptSecret(secret){
const messageBytes=nacl.util.decodeUTF8(secret);
const publicKeyBytes=nacl.util.decodeBase64(publicKey);
const encryptedBytes=nacl.box.seal(messageBytes,publicKeyBytes);
return nacl.util.encodeBase64(encryptedBytes);
}

await fetch(`${repoApi}/actions/secrets/TELEGRAM_TOKEN`,{
method:"PUT",
headers,
body:JSON.stringify({
encrypted_value:encryptSecret(tg),
key_id
})
});

await fetch(`${repoApi}/actions/secrets/OPENROUTER_KEY`,{
method:"PUT",
headers,
body:JSON.stringify({
encrypted_value:encryptSecret(openrouter),
key_id
})
});

log("üî• –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù");
log("–ü–µ—Ä–µ–π–¥–∏ –≤ GitHub ‚Üí Actions ‚Üí AI Bot Runner ‚Üí Run workflow");

}catch(e){
log("–û—à–∏–±–∫–∞: "+e.message);
}
}
</script>
</body>
</html>
