<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Telegram AI Bot AUTO</title>
<style>
body{background:#0f172a;color:white;font-family:Arial;padding:40px;max-width:700px;margin:auto}
input,textarea,button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none}
input,textarea{background:#1e293b;color:white}
button{background:#22c55e;font-weight:bold;cursor:pointer}
pre{background:black;padding:20px;height:220px;overflow:auto}
</style>
</head>
<body>

<h2>ðŸš€ Telegram AI Bot FULL AUTO</h2>

<input id="username" placeholder="GitHub Username">
<input id="token" placeholder="GitHub Classic Token (repo + workflow)">
<input id="repo" placeholder="Repository Name">
<input id="telegram" placeholder="Telegram Bot Token">
<input id="openrouter" placeholder="OpenRouter API Key">
<textarea id="prompt" placeholder="System Prompt"></textarea>

<button onclick="install()">INSTALL</button>
<pre id="log"></pre>

<script>

function log(t){document.getElementById("log").innerText+=t+"\n";}

async function createFile(path,content){
  await fetch(`https://api.github.com/repos/${username.value}/${repo.value}/contents/${path}`,{
    method:"PUT",
    headers:{
      "Authorization":"token "+token.value,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      message:"Add "+path,
      content:btoa(unescape(encodeURIComponent(content)))
    })
  });
}

async function triggerWorkflow(){
  await fetch(`https://api.github.com/repos/${username.value}/${repo.value}/actions/workflows/bot.yml/dispatches`,{
    method:"POST",
    headers:{
      "Authorization":"token "+token.value,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({ref:"main"})
  });
}

async function install(){

  log("â†’ Creating private repo...");

  await fetch("https://api.github.com/user/repos",{
    method:"POST",
    headers:{
      "Authorization":"token "+token.value,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      name:repo.value,
      private:true,
      auto_init:true
    })
  });

  log("âœ“ Repo created");

  const packageJson = `
{
  "name":"ai-bot",
  "version":"1.0.0",
  "main":"bot.js",
  "dependencies":{
    "axios":"^1.6.0",
    "dotenv":"^16.3.1"
  }
}
`;

  const botJs = `
require('dotenv').config();
const axios=require('axios');
const fs=require('fs');

const TELEGRAM_TOKEN=process.env.TELEGRAM_TOKEN;
const OPENROUTER_API_KEY=process.env.OPENROUTER_API_KEY;
const SYSTEM_PROMPT=process.env.SYSTEM_PROMPT;

const offsetFile='offset.json';

function getOffset(){
  if(!fs.existsSync(offsetFile))return 0;
  return JSON.parse(fs.readFileSync(offsetFile)).offset||0;
}

function saveOffset(offset){
  fs.writeFileSync(offsetFile,JSON.stringify({offset}));
}

async function commitOffset(offset){
  const data=fs.readFileSync(offsetFile).toString();
  const res=await axios.get(
    \`https://api.github.com/repos/\${process.env.GITHUB_REPOSITORY}/contents/offset.json\`,
    {headers:{Authorization:"token "+process.env.GITHUB_TOKEN}}
  );
  await axios.put(
    \`https://api.github.com/repos/\${process.env.GITHUB_REPOSITORY}/contents/offset.json\`,
    {
      message:"Update offset",
      content:Buffer.from(data).toString('base64'),
      sha:res.data.sha
    },
    {headers:{Authorization:"token "+process.env.GITHUB_TOKEN}}
  );
}

async function run(){

  const offset=getOffset();

  const updates=await axios.get(
    \`https://api.telegram.org/bot\${TELEGRAM_TOKEN}/getUpdates?offset=\${offset}&timeout=0\`
  );

  if(!updates.data.result.length)return;

  for(const update of updates.data.result){

    if(!update.message||!update.message.text)continue;

    const ai=await axios.post(
      "https://openrouter.ai/api/v1/chat/completions",
      {
        model:"openai/gpt-3.5-turbo",
        messages:[
          {role:"system",content:SYSTEM_PROMPT},
          {role:"user",content:update.message.text}
        ]
      },
      {headers:{Authorization:"Bearer "+OPENROUTER_API_KEY}}
    );

    const reply=ai.data.choices[0].message.content;

    await axios.post(
      \`https://api.telegram.org/bot\${TELEGRAM_TOKEN}/sendMessage\`,
      {chat_id:update.message.chat.id,text:reply}
    );

    saveOffset(update.update_id+1);
    await commitOffset(update.update_id+1);
  }
}

run();
`;

  const envFile=`
TELEGRAM_TOKEN=${telegram.value}
OPENROUTER_API_KEY=${openrouter.value}
SYSTEM_PROMPT=${prompt.value}
`;

  const offsetFile=`{"offset":0}`;

  const workflow=`
name: Bot

on:
  schedule:
    - cron: "*/1 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      - run: node bot.js
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
`;

  await createFile("package.json",packageJson);
  await createFile("bot.js",botJs);
  await createFile(".env",envFile);
  await createFile("offset.json",offsetFile);
  await createFile(".github/workflows/bot.yml",workflow);

  log("âœ“ Files created");
  log("â†’ Triggering workflow...");
  await triggerWorkflow();
  log("ðŸ”¥ FULL AUTO COMPLETE");

}

</script>
</body>
</html>
